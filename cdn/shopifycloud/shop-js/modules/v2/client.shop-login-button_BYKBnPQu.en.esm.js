import{i as e,I as o,_ as t,u as n,R as i,p as r,t as s,g as a,d as l,h as c,A as u,j as p,J as h,K as d,y as g,T as m,L as f,M as S,q as v,B as _,N as w,O as y,Q as I,U as b,V as x,W as C,X as T,Y as W,o as k,Z as O,a0 as N,k as A}from"./chunk.common_yHQg8wcp.esm.js";import{A as M}from"./chunk.modal_CWiRQXOf.esm.js";const P={loginWithShop:"default",loginWithShopSelfServe:"self_serve_customer_accounts",loginWithShopClassicCustomerAccounts:"classic_customer_accounts",loginWithShopPrequal:"shop_pay_installments_prequal",loginWithShopPaymentRequest:"payment_request",loginWithShopCheckoutExtension:"default",loginWithShopCheckoutModal:"checkout_modal",loginWithShopShopWeb:"",shopCashOffers:"shop_cash_offers"};function U({analyticsContext:e="loginWithShop",checkoutToken:o,checkoutVersion:t,flowVersion:n,shopId:i,source:r,uxMode:s}){return{analyticsContext:e,checkoutVersion:t,checkoutToken:o,flow:P[e],flowVersion:n,shopId:i,source:r,uxMode:s}}const B=["loginWithShop"],L=o=>{var{action:i,activatorId:P,analyticsContext:U="loginWithShop",anchorTo:L,autoOpen:j,email:q,emailInputSelector:R,experiments:V,firstname:E,fullWidth:H,hideButton:G,lastname:K,persistAfterSignIn:z=!0,proxy:D=!1,uxMode:F="iframe",version:$}=o,J=t(o,["action","activatorId","analyticsContext","anchorTo","autoOpen","email","emailInputSelector","experiments","firstname","fullWidth","hideButton","lastname","persistAfterSignIn","proxy","uxMode","version"]);const{notify:Q}=r(),{trackPageImpression:X,trackUserAction:Y}=s(),{translate:Z}=a(),[ee,oe]=l(!0),{instanceId:te}=c(),ne=u(P?p.getElementById(P):null),ie=u(null),re=u(null),se=u(null),[ae,le]=l(),ce=h({experiments:V,defaultUxMode:"redirect",uxMode:F}),{getSubmittedEmail:ue,updateEmailToPost:pe,updateNamesToPost:he}=d({autoOpen:j,email:q,emailInputSelector:R,iframeRef:re});g((()=>{he(E,K)}),[E,K,he]);const de=m((()=>{const e=e=>_(void 0,[e],void 0,(function*({detail:e}){le(void 0);const o=e.email;yield pe(o)}));return{requestShow:e,start:e}}),[pe]);f(de),g((()=>{var e,o;i&&("follow"===i?null===(e=console.warn)||void 0===e||e.call(console,"[Sign in with Shop] The action prop is deprecated, please use <shop-follow-button> instead."):null===(o=console.warn)||void 0===o||o.call(console,`[Sign in with Shop] Received deprecated attribute: action, "${i}"`))}),[i,Q]),g((()=>{G||X({page:"SIGN_IN_WITH_SHOP_BUTTON"})}),[G,X]);const ge=S({storefrontOrigin:J.storefrontOrigin}),me=v((e=>_(void 0,void 0,void 0,(function*(){const{email:o,givenName:t,userInteracted:n}=e;let i;z||oe(!1),n||(i=Z("shopLoginButton.toast.action"));let r=Z("shopLoginButton.toast.default");t&&(r=Z("shopLoginButton.toast.user",{user:t}));const s={actionText:i,analyticsTraceId:te,flow:J.flow,subText:o,text:r};B.includes(U)?w(s):"windoid"===ce&&y(I,s),yield ge(e)}))),[ce,U,te,z,J.flow,Z,ge]),fe="loginWithShopPrequal"===U?{disableSignUp:!1,flow:"prequal",flowVersion:"unspecified",hideCopy:!1,isCompactLayout:!1,proxy:!0}:{},Se=m((()=>{var e;return void 0!==$&&(null===(e=console.warn)||void 0===e||e.call(console,`[Sign in with Shop] Received deprecated attribute: version, "${$}"`)),D||"2"===$}),[D,$]),{authorizeUrl:ve,getAuthorizeUrl:_e}=b(Object.assign(Object.assign(Object.assign({analyticsContext:U,error:ae,experiments:V},J),{proxy:Se,uxMode:ce}),fe)),we=v((({code:e})=>{var o;switch(e){case"server_error":w({analyticsTraceId:te,flow:J.flow,text:Z("shopLoginButton.subject_mapping_error"),variant:"error"});break;case"retriable_server_error":ae===e&&(null===(o=re.current)||void 0===o||o.reload()),le(e)}}),[ae,te,J.flow,Z]),ye=x({handleComplete:me,handleError:we,windoidRef:se}),Ie=v((o=>{switch(ce){case"windoid":se.current=C(o,ye);break;case"redirect":e.location.href=o}}),[ce,ye]),be=v((()=>{Y({userAction:"SIGN_IN_WITH_SHOP_BUTTON_CLICK"}),Ie(ve)}),[ve,Ie,Y]),xe=T(be,150,!0),Ce=v((()=>{var e;Y({userAction:"SIGN_IN_WITH_SHOP_PROMPT_CHANGE_CLICK"}),null===(e=null==re?void 0:re.current)||void 0===e||e.close({dismissMethod:"prompt_change",reason:"user_prompt_change_clicked"})}),[Y]),Te=W({getAuthorizeUrl:_e,getEmail:ue,iframeRef:re,openWindoid:Ie}),We=G||ne.current||!ee?null:n(O,{fullWidth:H,onClick:xe,ref:ie,children:Z("shopLoginButton.continue",{shop:n(k,{className:"relative top-[0.05em] inline-block aspect-branded-button-icon h-branded-button-icon w-auto"})})}),ke="iframe"===ce,Oe=ne.current?ne:ie,Ne=ke?Oe:void 0,Ae=m((()=>ke?ve:_e({uxRole:"prompt"})),[ve,_e,ke]),Me=ke||N()?"default":"wide",Pe=m((()=>{const o=!(void 0===e||!e.Shopify||!e.Shopify.SignInWithShop)&&["initCustomerAccounts","initCustomerAccountsSignUp","initShopForNewCustomerAccounts"].some((o=>"function"==typeof e.Shopify.SignInWithShop[o]));return"windoid"!==ce&&"redirect"!==ce||o}),[ce]);return n(A,{children:[We,Pe&&n(M,{activator:Ne,anchorTo:L,autoOpen:j&&!se.current,onComplete:me,onError:we,onPromptChange:Ce,onPromptContinue:Te,proxy:Se,ref:re,src:Ae,modalType:Me,variant:"default"})]})},j=e=>_(void 0,void 0,void 0,(function*(){return{shopLoginButton:{title:"Sign in with Shop",continue:"Sign in with {shop}",toast:{default:"Signed in with Shop",user:"Signed in as {user}",action:"Switch"},subject_mapping_error:"To sign in with this email, continue without Shop."}}}));o((e=>{var{element:o}=e,r=t(e,["element"]);return n(i,{element:o,featureName:"ShopLoginButton",getFeatureDictionary:j,monorailProps:U(r),children:n(L,Object.assign({},r))})}),{methods:["requestShow","start","showToast"],name:"shop-login-button",props:{action:"string",activatorId:"string",analyticsContext:"string",anchorTo:"string",apiKey:"string",autoOpen:"boolean",avoidPayAltDomain:"boolean",checkoutVersion:"string",clientId:"string",codeChallenge:"string",codeChallengeMethod:"string",consentChallenge:"string",disableSignUp:"boolean",email:"string",emailInputSelector:"string",experiments:"string",firstname:"string",flow:"string",flowVersion:"string",fullWidth:"boolean",hideButton:"boolean",keepModalOpen:"boolean",lastname:"string",persistAfterSignIn:"boolean",popUpFeatures:"string",popUpName:"string",proxy:"boolean",redirectType:"string",redirectUri:"string",requireVerification:"boolean",responseMode:"string",responseType:"string",returnUri:"string",scope:"string",source:"string",state:"string",storefrontDomain:"string",uxMode:"string",version:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-login-button_BYKBnPQu.en.esm.js.map
