import"./client.shop-login-button_BYKBnPQu.en.esm.js";import{B as e,a2 as n,a6 as t,i as o,ac as i,an as a,E as s,j as r,ai as l,aj as c,ak as u,ao as d,ap as m,aq as p,al as f,af as g,ag as h,ar as v,a4 as b}from"./chunk.common_yHQg8wcp.esm.js";import"./chunk.modal_CWiRQXOf.esm.js";function _(){return e(this,arguments,void 0,(function*(b=!1,_){var E,w;const j=n(),k=new t("initCustomerAccounts"),A={analyticsContext:"loginWithShopClassicCustomerAccounts",analyticsTraceId:j,apiKey:"",flow:"classic_customer_accounts",flowVersion:"sign_in",shopPermanentDomain:null!==(w=null===(E=o.Shopify)||void 0===E?void 0:E.shop)&&void 0!==w?w:""},S=new i({analyticsData:A,notify:k.notify});try{if(a(o.location.pathname).endsWith("/account"))return void function(){e(this,void 0,void 0,(function*(){S.trackPageImpression({page:"CLASSIC_CUSTOMER_ACCOUNTS_ACCOUNT_PAGE"}),yield import("./loader.shop-toast-manager.en.esm.js")}))}();const n=new AbortController;(null==_?void 0:_.fedCMEnabled)&&function(e){const n=r.querySelector("#customer_login");if(!n)return;l({mediation:"required",analyticsTraceId:j,monorailTracker:S,signal:e}).then((e=>function(e,n,t,i){if(200!==(null==e?void 0:e.status))return void(null==i||i.notify(new Error("FedCM failed to authenticate")));if(!n)return void(null==i||i.notify(new Error("FedCM failed to find the nearest form to leverage sign in URL")));const a=y(n,t);o.location.assign(a)}(e,n,j,k))).catch((e=>function(e,n){if(e instanceof d||e instanceof m||"IdentityCredentialError"===e.name&&"Error retrieving a token."===e.message||e instanceof DOMException&&"NetworkError"===e.name&&"Error retrieving a token."===e.message)return;n.notify(e)}(e,k)))}(n.signal),function({abortFedCmController:e,autoOpen:n,initOptions:t}){const i=new WeakMap;let a=null;const s=c({onFallback:e=>{e.addEventListener("focus",l,{once:!0}),S.produceMonorailEvent({event:{schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0",payload:Object.assign(Object.assign({},A),{sdkVersion:"1.0.32-beta",errorCode:"fallback_to_focus_event",errorMessage:"Fallback to focus event for classic customer accounts"})}})},onVisible:t=>d({input:t,autoOpen:n,abortFedCmController:e})});function l(t){d({input:t.target,autoOpen:n,abortFedCmController:e})}function d({abortFedCmController:e,autoOpen:n,input:s}){var l;const c=s.form;if(!c)return;if(i.has(s)&&(null===(l=i.get(s))||void 0===l||l.destroy(),i.delete(s)),!a){a=function({autoOpen:e,initOptions:n}){let t,o=!1;t=r.querySelector("shop-login-button:not([action])"),t||(t=g("shop-login-button"),o=!0);const i=null==n?void 0:n.windoidEnabled;(function({element:e,props:n}){Object.entries(Object.assign(Object.assign({},C),n)).forEach((([n,t])=>{const o=v(n);e.setAttribute(o,String(t))}))})({element:t,props:Object.assign(Object.assign(Object.assign(Object.assign({autoOpen:e,consentChallenge:!0,disableSignUp:!0,experiments:JSON.stringify((null==n?void 0:n.experiments)||{})},o?{hideButton:!0}:{}),{proxy:!0}),h()),i&&{responseType:"code",uxMode:"windoid"})}),o&&r.body.appendChild(t);return t}({autoOpen:n,initOptions:t});const i=y(c,O(a));a.setAttribute("return-uri",i),a.addEventListener("completed",(()=>{o.location.assign(i)})),a.addEventListener("windoidopened",(()=>{null==e||e.abort(new m)})),a.addEventListener("modalclosed",(()=>{p("signInWithShop:modalDismissed","true")}))}a.getAttribute("defer-modal-on-autofill")&&a.setAttribute("email-input-selector",`#${s.id}`),a.setAttribute("email",s.value),i.set(s,new f(s,(e=>{null==a||a.setAttribute("email",e)})));const u=r.createElement("input");u.type="hidden",u.name="login_with_shop[analytics_trace_id]",u.value=O(a),c.appendChild(u)}u({onElementFound:e=>s.observe(e),selector:'form[data-login-with-shop-sign-in] input[type="email"],form[data-login-with-shop-sign-in] input[name="customer[email]"'})}({abortFedCmController:n,autoOpen:!(null==_?void 0:_.fedCMEnabled),initOptions:_})}catch(e){e instanceof Error&&k.notify(e),e instanceof s&&"InitCustomerAccountsError"===e.name&&S.produceMonorailEvent({event:{payload:Object.assign(Object.assign({},A),{analyticsTraceId:e.analyticsTraceId||j,errorCode:e.code,errorMessage:e.message,sdkVersion:"1.0.32-beta"}),schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0"}})}}))}const C={analyticsContext:"loginWithShopClassicCustomerAccounts",clientId:"",flow:"classic_customer_accounts",flowVersion:"sign_in"};function y(e,n){var t,i;const a=null===(t=e.elements.namedItem("checkout_url"))||void 0===t?void 0:t.value,s=null===(i=e.elements.namedItem("return_url"))||void 0===i?void 0:i.value,r=new URLSearchParams(Object.assign(Object.assign({analytics_trace_id:n},a&&{checkout_url:a}),s&&{return_url:s}));return`${o.location.origin}/account/redirect?${r.toString()}`}function O(e){return(null==e?void 0:e.getAttribute("data-instance-id"))||n()}b("initCustomerAccounts",_);
//# sourceMappingURL=client.init-customer-accounts_D6UlH3ze.en.esm.js.map
