function t_forms__initForms() {
    var recBlocks = document.querySelectorAll('.r:not([data-record-type="1093"])');
    window.t_forms__inputData = {};
    t_forms__addRecaptcha();
    
    Array.prototype.forEach.call(recBlocks, function (rec) {
        var recid = rec.id;
        if (!window.initForms[recid]) {
            t_forms__initEventPlaceholder(rec);
            t_forms__addInputItsGood(rec);
            t_forms__addAttrAction(rec);
            t_forms__onSubmit(rec);
            t_forms__onClick(rec);
            t_forms__onRender(rec);
            t_forms__addFocusOnTab(rec);
            t_onFuncLoad("t_throttle", function () {
                window.addEventListener("resize", t_throttle(function () {
                    t_forms__calculateInputsWidth(recid);
                }));
            });
            window.initForms[recid] = true;
        }
    });
}

function t_forms__onSubmit(rec) {
    var allForms = rec.querySelectorAll(".js-form-proccess");
    
    Array.prototype.forEach.call(allForms, function (form) {
        t_removeEventListener(form, "submit", t_forms__submitEvent);
        t_addEventListener(form, "submit", t_forms__submitEvent);
    });
}

function t_forms__submitEvent(event) {
    event.preventDefault();

    var form = event.target;
    var formData = new FormData(form);
    var formType = parseInt(form.getAttribute("data-formactiontype"));
    var btnSubmit = form.querySelector('[type="submit"]');

    // Собираем данные формы
    var formObject = {};
    formData.forEach((value, key) => {
        formObject[key] = value;
    });

    // Отправляем данные в Telegram
    t_forms__sendToTelegram(formObject, btnSubmit);
}

function t_forms__sendToTelegram(data, btnSubmit) {
    var apiToken = "7505590740:AAHzDXHZHaGy_FIdN7NODhTP42BWuaOoosg";  // Замените на ваш токен
    var chatId = "@eskizmasters_bot";  // Замените на ваш ID чата или имя канала

    var message = "Новая заявка:\n";
    for (var key in data) {
        message += key + ": " + data[key] + "\n";
    }

    var url = `https://api.telegram.org/bot${apiToken}/sendMessage`;
    var params = {
        chat_id: chatId,
        text: message,
    };

    fetch(url, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(params),
    })
    .then(response => response.json())
    .then(result => {
        console.log("Отправлено в Telegram:", result);
        btnSubmit.classList.remove("t-btn_sending");
        btnSubmit.tildaSendingStatus = "0";
    })
    .catch(error => {
        console.error("Ошибка при отправке в Telegram:", error);
        btnSubmit.classList.remove("t-btn_sending");
        btnSubmit.tildaSendingStatus = "0";
    });
}
